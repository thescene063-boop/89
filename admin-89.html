<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢ | The Scene 89</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">

  <!-- CSS ‡∏Å‡∏•‡∏≤‡∏á -->
  <link rel="stylesheet" href="css/style.css">
  <style>
    body {
      padding-top: 80px;
      font-family: 'Prompt', sans-serif;
      color: #fff;
      background-color: #141414; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÑ‡∏ß‡πâ */
      margin: 0;
    }

    /* ===== LOGIN ===== */
    #loginScreen {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, #1a1a1a, #000);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .login-box {
      width: 100%;
      max-width: 380px;
      background: rgba(255,255,255,0.06);
      padding: 32px;
      border-radius: 22px;
      box-shadow: 0 30px 60px rgba(0,0,0,0.6);
      text-align: center;
    }

    .login-box h1 { margin-bottom: 10px; margin-top: 0; }
    .login-box p { opacity: .7; margin-bottom: 24px; }

    .login-box input {
      width: 100%;
      padding: 14px;
      border-radius: 14px;
      border: none;
      margin-bottom: 16px;
      text-align: center;
      font-size: 15px;
      box-sizing: border-box;
    }

    .login-box button {
      width: 100%;
      padding: 14px;
      border-radius: 16px;
      border: none;
      background: #e50914;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      font-weight: 600;
    }

    .login-error {
      margin-top: 12px;
      color: #ff5c5c;
      font-size: 14px;
      display: none;
    }

    /* ===== ADMIN ===== */
    #adminScreen { display: none; }

    .admin-container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 20px 80px;
    }

    h1 { text-align: center; margin-bottom: 30px; }

    .admin-panel {
      max-width: 520px;
      margin: 0 auto 50px;
      background: rgba(255,255,255,0.06);
      padding: 24px;
      border-radius: 20px;
    }

    .admin-panel input {
      width: 100%;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 12px;
      border: none;
      box-sizing: border-box;
      background: rgba(255,255,255,0.9);
    }

    .primary-btn {
      width: 100%;
      padding: 12px;
      border-radius: 14px;
      background: #e50914;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
    }

    .primary-btn:hover { background: #f40612; }

    .admin-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 24px;
    }

    .movie-card {
      background: rgba(255,255,255,0.07);
      border-radius: 18px;
      overflow: hidden;
      position: relative;
      transition: transform 0.2s;
    }
    
    .movie-card:hover { transform: translateY(-5px); }

    .movie-card img {
      width: 100%;
      height: 280px;
      object-fit: cover;
      display: block;
    }

    .movie-title {
      padding: 12px;
      text-align: center;
      min-height: 50px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .delete-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 30, 30, 0.9);
      border: none;
      color: #fff;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      cursor: pointer;
      z-index: 2;
    }

    .edit-btn {
      display: block;
      margin: 0 auto 15px;
      padding: 6px 16px;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.2);
      background: transparent;
      color: #ccc;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }
    .edit-btn:hover { background: #fff; color: #000; }

    /* Edit Mode Inputs */
    .edit-input {
        width: 90%;
        padding: 6px;
        border-radius: 8px;
        border: none;
        margin-bottom: 6px;
        font-family: 'Prompt', sans-serif;
    }
    .save-btn {
        padding: 5px 14px;
        border-radius: 10px;
        border: none;
        background: #1db954;
        color: #fff;
        cursor: pointer;
        font-family: 'Prompt', sans-serif;
    }
  </style>
</head>

<body>

<div id="loginScreen">
  <div class="login-box">
    <h1>üîê Admin Login</h1>
    <p>The Scene 89</p>

    <input type="password" id="adminPass" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (1234)"
      onkeydown="if(event.key==='Enter') login()">

    <button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <div class="login-error" id="loginError">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>
  </div>
</div>

<div id="adminScreen">
  <div id="navbar"></div> <div class="admin-container">
    <h1>Admin : ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á</h1>

    <div class="admin-panel">
      <input id="searchInput" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á..." oninput="searchMovie()">
      <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 20px 0;">
      <input id="titleInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á">
      <input id="posterInput" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ (URL)">
      <input id="linkInput" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå X / ‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á">
      <button class="primary-btn" id="addBtn">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á</button>
      <button class="primary-btn" 
      
        style="margin-top:10px; background:#b00020;"
        id="deleteAllBtn">
  üóë ‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

  <button class="primary-btn"
        style="margin-top:10px; background:#530007;"
        id="deleteSelectedBtn">
  üóë ‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
</button>
</button>
    </div>

    <div class="admin-grid" id="adminGrid">
        </div>
  </div>
</div>

<script>
  // --- AUTH SYSTEM (Client Side) ---
  const ADMIN_PASS = "1234";
  const loginScreen = document.getElementById("loginScreen");
  const adminScreen = document.getElementById("adminScreen");
  const errorBox = document.getElementById("loginError");
  const passInput = document.getElementById("adminPass");

  function checkSession() {
    if (sessionStorage.getItem("adminAuth") === "true") {
        loginScreen.style.display = "none";
        adminScreen.style.display = "block";
        loadMovies(); // ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡∏±‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ Login ‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    }
  }

  function login() {
    if (passInput.value === ADMIN_PASS) {
      sessionStorage.setItem("adminAuth", "true");
      checkSession();
    } else {
      errorBox.style.display = "block";
    }
  }
  
  // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö
  checkSession();
</script>

<script src="js/navbar.js"></script>

<script type="module">
  import { db } from "./js/firebase.js";
  import { 
    collection, 
    getDocs, 
    addDoc, 
    deleteDoc, 
    updateDoc, 
    doc 
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
// üî• ‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
document.getElementById("deleteAllBtn").onclick = async () => {
    const confirm1 = confirm("‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?");
    if (!confirm1) return;

    const confirm2 = confirm("‚ùó ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡∏•‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ");
    if (!confirm2) return;

    try {
        const snap = await getDocs(collection(db, "movies"));

        if (snap.empty) {
            alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏ö");
            return;
        }

        // ‡∏•‡∏ö‡∏ó‡∏µ‡∏•‡∏∞ document
        const promises = [];
        snap.forEach(d => {
            promises.push(deleteDoc(doc(db, "movies", d.id)));
        });

        await Promise.all(promises);

        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏´‡∏ô‡πâ‡∏≤
        document.getElementById("adminGrid").innerHTML =
            '<p style="text-align:center;width:100%;">üßπ ‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</p>';

        alert("‚úÖ ‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    } catch (err) {
        console.error(err);
        alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö");
    }
};

  // ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global ‡πÉ‡∏´‡πâ Window ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
  window.loadMovies = async () => {
    const grid = document.getElementById("adminGrid");
    grid.innerHTML = '<p style="text-align:center; width:100%;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>';
    
    try {
        const snap = await getDocs(collection(db, "movies"));
        
        // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏™‡πà Array ‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö
        let movies = [];
        snap.forEach(d => {
            movies.push({ id: d.id, ...d.data() });
        });

        // 2. ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á (Sort) ‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á (createdAt) ‡∏à‡∏≤‡∏Å ‡∏°‡∏≤‡∏Å -> ‡∏ô‡πâ‡∏≠‡∏¢ (‡πÉ‡∏´‡∏°‡πà -> ‡πÄ‡∏Å‡πà‡∏≤)
        // (‡∏ñ‡πâ‡∏≤‡∏´‡∏ô‡∏±‡∏á‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ field createdAt ‡∏°‡∏±‡∏ô‡∏à‡∏∞‡πÑ‡∏õ‡∏Å‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á)
        movies.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));

        grid.innerHTML = ""; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå Loading

        // 3. ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (‡∏Ñ‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏ä‡πâ appendChild ‡∏ï‡πà‡∏≠‡∏ï‡∏π‡∏î‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢)
        movies.forEach(m => {
            createMovieCard(m.id, m, false);
        });

    } catch (e) {
        console.error("Error loading movies:", e);
        grid.innerHTML = '<p style="color:red; text-align:center;">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
    }
  };

  function createMovieCard(id, data, insertTop = false) {
    const grid = document.getElementById("adminGrid");
    
    const card = document.createElement("div");
    card.className = "movie-card";
    card.dataset.id = id; // ‡πÄ‡∏Å‡πá‡∏ö id ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡∏•‡∏ö
    card.dataset.title = (data.title || "").toLowerCase(); 
// checkbox ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
const checkbox = document.createElement("input");
checkbox.type = "checkbox";
checkbox.className = "select-movie";
checkbox.style.position = "absolute";
checkbox.style.top = "10px";
checkbox.style.right = "10px";
checkbox.style.transform = "scale(1.4)";
checkbox.style.zIndex = "3";

card.appendChild(checkbox);

    // ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö
    const delBtn = document.createElement("button");
    delBtn.className = "delete-btn";
    delBtn.textContent = "‡∏•‡∏ö";
    delBtn.onclick = async () => {
        if(confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö "${data.title}"?`)) {
            await deleteDoc(doc(db, "movies", id));
            card.remove(); 
        }
    };

    // ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
    const img = document.createElement("img");
    img.src = data.poster;
    img.onerror = () => { img.src = 'https://via.placeholder.com/300x400?text=No+Image'; };

    // ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á
    const titleDiv = document.createElement("div");
    titleDiv.className = "movie-title";
    titleDiv.textContent = data.title;

    // ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    const editBtn = document.createElement("button");
    editBtn.className = "edit-btn";
    editBtn.textContent = "‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç";
    editBtn.onclick = () => enableEditMode(id, data, titleDiv, card);

    card.appendChild(delBtn);
    card.appendChild(img);
    card.appendChild(titleDiv);
    card.appendChild(editBtn);
    
    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà (insertTop = true) ‡πÉ‡∏´‡πâ‡πÅ‡∏ó‡∏£‡∏Å‡∏ö‡∏ô‡∏™‡∏∏‡∏î
    // ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
    if (insertTop) {
        grid.prepend(card); 
    } else {
        grid.appendChild(card); 
    }
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
  function enableEditMode(id, currentData, container, cardElement) {
    container.innerHTML = ""; 

    const iTitle = document.createElement("input");
    iTitle.value = currentData.title;
    iTitle.className = "edit-input";
    iTitle.placeholder = "‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á";

    const iPoster = document.createElement("input");
    iPoster.value = currentData.poster;
    iPoster.className = "edit-input";
    iPoster.placeholder = "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ";

    const iLink = document.createElement("input");
    iLink.value = currentData.link;
    iLink.className = "edit-input";
    iLink.placeholder = "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡∏ô‡∏±‡∏á";

    const saveBtn = document.createElement("button");
    saveBtn.textContent = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å";
    saveBtn.className = "save-btn";
    
    saveBtn.onclick = async () => {
       const newData = {
    title: iTitle.value.trim(),
    poster: convertDriveImage(iPoster.value.trim()),
    link: iLink.value.trim()
};

        if(!newData.title || !newData.poster) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û");
            return;
        }

        saveBtn.textContent = "‚è≥...";
        await updateDoc(doc(db, "movies", id), newData);
        
        container.innerHTML = newData.title; 
        cardElement.querySelector("img").src = newData.poster;
        cardElement.dataset.title = newData.title.toLowerCase(); 
        
        const newEditBtn = cardElement.querySelector(".edit-btn");
        newEditBtn.onclick = () => enableEditMode(id, newData, container, cardElement);
    };

    container.appendChild(iTitle);
    container.appendChild(iPoster);
    container.appendChild(iLink);
    container.appendChild(saveBtn);
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á
  document.getElementById("addBtn").onclick = async () => {
    const title = document.getElementById("titleInput").value;
   const poster = convertDriveImage(
    document.getElementById("posterInput").value
);

    const link = document.getElementById("linkInput").value;

    if(!title || !poster) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
        return;
    }

    const btn = document.getElementById("addBtn");
    btn.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°...";
    btn.disabled = true;

    try {
        // üî• ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Date.now()) ‡∏•‡∏á‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
        const newItem = { 
            title, 
            poster, 
            link,
            createdAt: Date.now() // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏á
        };

        const docRef = await addDoc(collection(db, "movies"), newItem);
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÅ‡∏ó‡∏£‡∏Å‡∏ö‡∏ô‡∏™‡∏∏‡∏î)
        createMovieCard(docRef.id, newItem, true);
        
        document.getElementById("titleInput").value = "";
        document.getElementById("posterInput").value = "";
        document.getElementById("linkInput").value = "";
    } catch(e) {
        console.error(e);
        alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    }
    
    btn.textContent = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á";
    btn.disabled = false;
  };

  window.searchMovie = () => {
    const k = document.getElementById("searchInput").value.toLowerCase();
    document.querySelectorAll(".movie-card").forEach(c => {
      c.style.display = c.dataset.title.includes(k) ? "block" : "none";
    });
  };

  if(sessionStorage.getItem("adminAuth") === "true") {
      loadMovies();
  }

  // üîÅ ‡πÅ‡∏õ‡∏•‡∏á Google Drive URL ‚Üí lh3.googleusercontent
function convertDriveImage(url) {
    if (!url) return url;

    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô lh3 ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏á
    if (url.includes("lh3.googleusercontent.com/d/")) {
        return url.trim();
    }

    let fileId = "";

    // ‡πÅ‡∏ö‡∏ö /file/d/FILE_ID/
    const match1 = url.match(/\/d\/([a-zA-Z0-9_-]+)/);

    // ‡πÅ‡∏ö‡∏ö ?id=FILE_ID
    const match2 = url.match(/[?&]id=([a-zA-Z0-9_-]+)/);

    if (match1) fileId = match1[1];
    if (match2) fileId = match2[1];

    if (fileId) {
        return `https://lh3.googleusercontent.com/d/${fileId}`;
    }

    // ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Drive ‚Üí ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
    return url.trim();
}
// üóë ‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
document.getElementById("deleteSelectedBtn").onclick = async () => {
    const selected = document.querySelectorAll(".select-movie:checked");

    if (selected.length === 0) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö");
        return;
    }

    if (!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á ${selected.length} ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á?`)) return;

    try {
        const promises = [];

        selected.forEach(cb => {
            const card = cb.closest(".movie-card");
            const id = card.dataset.id;
            promises.push(deleteDoc(doc(db, "movies", id)));
        });

        await Promise.all(promises);

        // ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        selected.forEach(cb => cb.closest(".movie-card").remove());

        alert("‚úÖ ‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
    } catch (err) {
        console.error(err);
        alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö");
    }
};

</script>
  <!-- ‡πÇ‡∏´‡∏•‡∏î Navbar -->
  <script src="js/navbar.js"></script>
</body>
</html>